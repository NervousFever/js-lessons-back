// const getSize = require("get-folder-size");

const fs = require("fs");
const path = require("path");

/**
 * Trả về danh sách các thư mục con với các thông tin ngày giờ và kích cỡ
 * @param {*} mainFolder
 */
module.exports = (mainFolder, isMb) => {
    return new Promise(async (resolve) => {
        let repoes = [];
        if (!mainFolder || typeof mainFolder !== "string" || !fs.existsSync(mainFolder)) {
            resolve(repoes);;
            return;
        }
        try {
            let subFolders = fs.readdirSync(mainFolder);
            // console.log(mainFolder, subFolders);
            for (let i = 0; i < subFolders.length; i++) {
                let file = subFolders[i];
                let fullFoldername = mainFolder + path.sep + file;
                let stats = fs.lstatSync(fullFoldername);
                if (stats.isDirectory()) {
                    repoes.push({
                        repo: file,
                        ...stats,
                        size: "..." + (isMb ? "MBs" : "Bytes"),
                    });
                }
            }
        } catch (e) {
            // console.log('Error: ', e);
            repoes.push({
                repo: mainFolder,
                error: e,
            });
        }
        resolve(repoes);
    });
}
