/**
 * Đọc các đường dẫn phụ của rootEntry, tạo một file index.js 
 * xuất bảng các object của các đường dẫn con tự động
 * @param {*} rootEntry 
 */
const fs = require('fs');
const path = require('path');
const convertPath2ObjectName = require("./convert-path-2-object-name");

module.exports = (rootEntry, isForce = false) => {
    // đường dẫn phụ
    let subFolders = fs.readdirSync(rootEntry);
    let objNames = "";
    for (let subFolder of subFolders) {
        let stats = fs.statSync(`${rootEntry}${path.sep}${subFolder}`);
        // chỉ đường dẫn mới tạo yêu cầu xuất khẩu đối tượng
        if (subFolder) {
            if (stats.isDirectory()) {
                objNames += `    ${convertPath2ObjectName(subFolder)}:require("./${subFolder}"),\n`;
            } else {
                // đây là tên file
                let ext = path.extname(subFolder);
                if (ext && ext.toLocaleLowerCase() === ".js" && subFolder.toLocaleLowerCase() !== "index.js") {
                    // kiểm tra kiểu file là .js thì cũng xuất bản tên file thôi
                    let fileName = subFolder.split('.').slice(0, -1).join('.');
                    objNames += `    ${convertPath2ObjectName(fileName)}:require("./${fileName}"),\n`;
                }
            }
        }
    }

    let indexFileName = `${rootEntry}${path.sep}index.js`;

    if (isForce || !fs.existsSync(indexFileName)) {
        fs.writeFileSync(
            indexFileName,
            `// This file auto create from function creatEntryIndex of cng-node-js-utils lib
            
module.exports = {
    // export entry for out side 
${objNames}
}
`);
    }
    console.log("***>Export success to ", indexFileName);
}